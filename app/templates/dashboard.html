{% extends "base.html" %}
{% block head %}

    <title>Task Manager</title>
{% endblock %}
{% block body %}
    <div class="container max-w-6xl px-12 mx-auto mt-24">
        <h1 class="text-cyan-900 text-4xl py-8">Witaj {{ current_user.name }}</h1>
        {% if task | length < 1 %}
        <h1 class="text-2xl pb-4">No Task Here! Go Get Some</h1>
        {% else %}
        <table class="w-full table-auto text-left">
        <thead>
        <tr>
            <th class="border-y border-gray-200 bg-gray-200 p-4">
                <p class="block antialiased font-sans text-sm text-blue-900 font-bold leading-none opacity-70">Task</p>
            </th>
            <th class="border-y border-gray-200 bg-gray-200 p-4">
                <p class="block antialiased font-sans text-sm text-blue-900 font-bold leading-none opacity-70">Description</p>
            </th>
            <th class="border-y border-gray-200 bg-gray-200 p-4">
                <p class="block antialiased font-sans text-sm text-blue-900 font-bold leading-none opacity-70">Added</p>
            </th>
            <th class="border-y border-gray-200 bg-gray-200 p-4">
                <p class="block antialiased font-sans text-sm text-blue-900 font-bold leading-none opacity-70">Action</p>
            </th>
        </tr>
        </thead>
        <tbody>
        
            {% for task in task %}
                    
            <tr>    
                <td class="p-4 border-b border-gray-200">
                    <p class="block antialiased font-sans text-sm leading-normal font-normal">{{ task.content }}</p>
                </td>
                <td class="p-4 border-b border-gray-200">
                    <p class="block antialiased font-sans text-sm leading-normal font-normal">
                        {{ task.description | truncate(60, True, '...') }}
                    </p>
                </td>
                <td class="p-4 border-b border-gray-200">
                    <p class="block antialiased font-sans text-sm leading-normal font-normal">{{ task.created.strftime("%Y-%m-%d") }}</p>
                </td>
                <td class="p-4 border-b border-gray-200">
                    <p class="gap-4 flex flex-row antialiased font-sans text-sm leading-normal font-normal text-slate-100">
                        <button
                            type="button"
                            class="py-2 px-4 bg-red-500 text-white hover:cursor-pointer hover:bg-red-600 btn-delete"
                            data-delete-url="{{ url_for('api.delete', id=task.id) }}"
                            data-task-name="{{ task.content }}">
                            Delete
                        </button>
                        <a class="py-2 px-4 bg-slate-500 hover:bg-slate-600" href='/dashboard/edit/{{ task.id }}'>Edit</a>
                    </p>
                </td>
            </tr>

            {% endfor %}
        </tbody>
        </table>
        {% endif %}
        <form class="py-6 flex flex-col max-w-96 gap-4" action="{{ url_for('main.dashboard') }}" method="POST">
            <input class="p-2 border border-gray-300" placeholder="Task Name" type="text" name="content" id="content"/>
            <textarea class="p-2 border border-gray-300" placeholder="Task Description" name="description" id="description" rows="4"></textarea>
            <input class="py-2 px-4 bg-green-600 hover:bg-green-700 text-slate-100 hover:cursor-pointer" type="submit" value="Add Task" id="btn_add"/>
        </form>
    </div>
    <!-- Modal -->
    <div id="deleteModal"
        class="fixed inset-0 z-50 bg-black/50 hidden flex items-center justify-center">
    <div class="bg-white shadow-xl max-w-md w-full mx-4 p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-2">
        Potwierdzenie usunięcia
        </h2>

        <p class="text-sm text-gray-600 mb-4">
        Czy na pewno chcesz usunąć zadanie:
        <span id="modalTaskName" class="font-semibold text-gray-900"></span>?
        </p>

        <div class="flex justify-end gap-3">
        <button type="button"
                id="cancelDelete"
                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200">
            Anuluj
        </button>
        <button type="button"
                id="confirmDelete"
                class="px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700">
            Usuń
        </button>
        </div>
    </div>
    </div>
<script>
  const modal = document.getElementById("deleteModal");
  const modalTaskName = document.getElementById("modalTaskName");
  const cancelBtn = document.getElementById("cancelDelete");
  const confirmBtn = document.getElementById("confirmDelete");

  let currentDeleteUrl = null;

  // nasłuchiwanie na przyciski Delete
  document.querySelectorAll(".btn-delete").forEach((btn) => {
    btn.addEventListener("click", () => {
      currentDeleteUrl = btn.dataset.deleteUrl;
      modalTaskName.textContent = btn.dataset.taskName || "";
      modal.classList.remove("hidden");
    });
  });

  // Anuluj
  cancelBtn.addEventListener("click", () => {
    modal.classList.add("hidden");
    currentDeleteUrl = null;
  });

  // Potwierdź
  confirmBtn.addEventListener("click", () => {
    if (currentDeleteUrl) {
      window.location.href = currentDeleteUrl;
    }
  });

  // Kliknięcie w tło zamyka modal
  modal.addEventListener("click", (e) => {
    if (e.target === modal) {
      modal.classList.add("hidden");
      currentDeleteUrl = null;
    }
  });
</script>
{% endblock %}